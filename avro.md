## Формирование сообщения в формате AVRO

Внешняя компонения может формировать файлы в бинарном формате **AVRO**, который поддерживает передачу данных по схемам, которые записываются в заголовок файла формата **AVRO** при его создании.


### Формирование сообщения в формате AVRO
Сохранение схемы, которая будет использоваться для **AVRO**.
```1С
СохранитьСхемуAVRO(ИмяСхемыJSON, СхемаJSON);
```

**ИмяСхемыJSON** - Строка. Обязательный. Имя схемы.

**СхемаJSON** - Строка. Обязательный. Схема, по которой формируются данные (см. параметр **ДанныеJSON** процедуры **ПреобразоватьВФорматAVRO**). Схема должна быть представлена в следующем виде:
```json
{
  "type": "record",
  "name": "user",
  "fields": [
    {
      "name": "id",
      "type": "string"
    },
    {
      "name": "name",
      "type": "string"
    },
    {
      "name": "phone",
      "type": [
        "null",
        "string"
      ]
    }
   ]
}
```
**Возвращает** значение типа булево - "Истина", если операция выполнена успешно.
"Ложь", если была ошибка. 
Текст ошибки можно получить функцией **ПолучитьСообщениеОбОшибке**.

### Формирование **AVRO** из JSON
```1С
ПреобразоватьВФорматAVRO(ДанныеJSON, ИмяСхемыJSON);
``` 

**ДанныеJSON** - Строка. Обязательный. Данные в формате **JSON**, представленные в следующем виде:
```json
{
  "id":    ["1", "2", "3"],
  "name":  ["Ivan", "Maksim", "Vitaly"],
  "phone": ["+79115672342", "null", "+79185172317"],
  "age":   ["null", 45, 25] 
}
``` 

Такой массив определяет 3 объекта:
```json
[
  {
    "id":    "1",
    "name":  "Vasiliy",
    "phone": "+79115672342",
    "age":   "null"
  },
  {
    "id":    "2",
    "name":  "Maksim",
    "phone": "null",
    "age":   45
  },
  {
    "id":    "3",
    "name":  "Vitaly",
    "phone": "+79185172317",
    "age":   25
  }
]
``` 


**<span style="color: blue">Обратите внимание, </span>** что:
* в каждом поле должен быть массив с одинаковым количеством элементов;
* поля должны быть перечислены строго в той последовательности, в которой определены в схеме (описание схемы далее). 

**ИмяСхемыJSON** - Строка. Обязательный. Имя схемы, которая ранее был сохранена процедурой **СохранитьСхемуAVRO**

**Возвращает** значение типа булево - "Истина", если операция выполнена успешно.
"Ложь", если была ошибка. 
Текст ошибки можно получить функцией **ПолучитьСообщениеОбОшибке**.
 


### Отправка данных в формате AVRO в Kafka

В случае успешного формирования файла **AVRO** данные можно отправить в соответствующий топик в **Kafka** при помощи следующего метода:

```1c
ОтправитьДанныеФайлаAVRO(Топик, Партиция, Ключ, Заголовки)
```


**Топик** - Строка. Обязательный. 

**Партиция** - Число. Обязательный. Если не указано значение, то по умолчанию запись производится в 0 партицию.

**Ключ** - Строка. Необязательный параметр. Ключ сообщения, который может использоваться в темах с уплотнением сообщений по ключу.

**Заголовки** - Строка. Обязательный. Перечень заголовков, состоящих из ключа и значения в следующем формате "ключ1,значение1;ключ2,значение2"

**Возвращает** значение типа булево - "Истина", если при доставке все брокеры вернули подтверждение о приемке сообщения, 
"Ложь", если была ошибка, если хотя бы один брокер не подтвердил получение или не было получено подтверждение от брокеров в течении 20 секунд. 
Текст ошибки можно получить функцией **ПолучитьСообщениеОбОшибке**.

### Сохранение данных в формате AVRO в файл

Файл **AVRO** можно сохранить в файл:

```1c
СохранитьФайлAVRO(ИмяФайла)
```

**ИмяФайла** - Строка. Обязательный. 


