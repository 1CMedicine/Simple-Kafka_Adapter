## Работа с форматом AVRO

Значимую роль в производительности **Apache Kafka** играет сериализация данных, отправляющихся в топики. Также всегда важно соблюдать определённый формат для обмена данными, чтобы процесс работы системы был корректным. В связи с этим в **Apache Kafka** применяется бинарный формат **AVRO**, который поддерживает передачу данных в JSON-формате и при этом позволяет формировать сообщения по схемам, которые записываются в заголовок файла формата **AVRO** при его создании.


### Формирование сообщения в формате AVRO

Для формирования такого **AVRO** требуется воспользоваться следующим методом (является процедурой):
```1С
ПреобразоватьВФорматAVRO(ДанныеJSON, СхемаJSON);
``` 

Оба параметра являются обязательными для заполнения.

***
**ДанныеJSON** - Строка. Данные в формате **JSON**, представленные в следующем виде:
```json
{
  "id":    ["1", "2", "3"],
  "name":  ["Ivan", "Maksim", "Vitaly"],
  "phone": ["+79115672342", "null", "+79185172317"],
  "age":   ["null", 45, 25] 
}
``` 

Такой массив определяет 3 объекта:
```json
[
  {
    "id":    "1",
    "name":  "Vasiliy",
    "phone": "+79115672342",
    "age":   "null"
  },
  {
    "id":    "2",
    "name":  "Maksim",
    "phone": "null",
    "age":   45
  },
  {
    "id":    "3",
    "name":  "Vitaly",
    "phone": "+79185172317",
    "age":   25
  }
]
``` 


**<span style="color: blue">Обратите внимание, </span>** что:
* в каждом поле должен быть массив с одинаковым количеством элементов;
* поля должны быть перечислены строго в той последовательности, в которой определены в схеме (описание схемы далее). 


***
**СхемаJSON** - Строка. Схема, по которой формируются данные, которые записаны в параметр  **ДанныеJSON**. Схема должна быть представлена в следующем виде:
```json
{
  "type": "record",
  "name": "user",
  "fields": [
    {
      "name": "id",
      "type": "string"
    },
    {
      "name": "name",
      "type": "string"
    }
    {
      "name": "phone",
      "type": [
        "null",
        "string"
      ]
    }
}
``` 

Также в схеме может указываться поле **namespace**:
```json
{
  "type": "record",
  "name": "user",
  "namespace": "department"
  "fields": [
    ...
  ]
}
```

***

### Отправка данных в формате AVRO в Kafka

В случае успешного формирования файла **AVRO** данные можно отправить в соответствующий топик в **Kafka** при помощи следующего метода:

```1c
ОтправитьДанныеФайлаAVRO(Топик, Партиция, Ключ, Заголовки)
```

Обязательным к заполнению является только первый параметр.

**Топик** - Строка.

**Партиция** - Число. Если не указано значение, то по умолчанию запись производится в 0 раздел.

**Ключ** - Строка. Необязательный параметр. Ключ сообщения, который может использоваться в темах с уплотнением сообщений по ключу.

**Заголовки** - Строка. Перечень заголовков, состоящих из ключа и значения в следующем формате "ключ1,значение1;ключ2,значение2"

 Метод возвращает значение типа булево - "Истина", если при доставке все брокеры вернули подтверждение о приемке сообщения, "Ложь", если хотя бы один брокер не подтвердил получение или не было получено подтверждение от брокеров в течении 20 секунд. 